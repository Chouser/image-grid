<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>grid</title>
    <style type="text/css">
      html, head, body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
      canvas {
        display: block;
        top: 0;
        position: absolute;
      }
      div {
        text-align: center;
      }
      img {
        display: none;
      }
    </style>
    <script type="text/javascript">//<![CDATA[

var hex = '0123456789ABCDEF'.split('');
var dec = {};
for( var i = 0; i < hex.length; ++i ) {
  dec[ hex[ i ] ] = i;
}

var c1, ctx;

function drawGrid(ctx, ix, iy, d, xt, yt, xf, yf) {
  var x, y;
  for(x = ix; x < xf + xt; x += d) {
    for(y = iy; y < yf + yt; y += d) {
      ctx.moveTo(x-xt,y);
      ctx.lineTo(x+xt+1,y);
      ctx.moveTo(x,y-yt);
      ctx.lineTo(x,y+yt+1);
    }
  }
}

var frame = 0;

function xform() {
  ctx.translate( -35, -35 );
  ctx.scale( 0.3, 0.3 );
}

function doframe() {
  ctx.save();
  xform();
  ctx.beginPath();
  drawGrid(ctx, 0, 50, 300,   50, 50, img.width, img.height);
  drawGrid(ctx, 0, 50, 300/3, 10, 10, img.width, img.height);
  ctx.closePath();
  var x = hex[Math.abs(frame%31-15)];
  ctx.strokeStyle = "#" + x + x + x + ";";
  ctx.stroke();
  ctx.restore();

  frame += 1;
  setTimeout(doframe, 200);
}

function start() {
  var body = document.body;
  var img = document.getElementById('img');

  c1 = document.getElementById('c1');
  c1.width = body.offsetWidth;
  c1.height = body.offsetHeight;
  c1.onclick = start;
  ctx = c1.getContext("2d");

  ctx.save();
  xform();
  ctx.drawImage(document.getElementById('img'), 0, 0);
  ctx.restore();

  doframe();
}

window.onload = function() {
  inrand = document.location.hash.substr(1).split('');
  start();
}

//]]>
    </script>
  </head>

  <body>
    <img id="img" src="2006.08.17-09150.jpg" />
    <canvas id="c1"></canvas><canvas id="c2"></canvas>
  </body>
</html>

